<section class="password-container">
  <!-- Change Password Settings Header -->
  <h2>Change Password</h2>
  
  <!-- Change Password Form -->
  <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()" class="changePassword-form">
    
    <!-- Current Password Field and its Error Handling -->
    <div class="form-group">
      <label for="currentPassword">Current Password</label>
      <div class="currentPassword-input-container">
          <input 
            class="form-control"
            [ngClass]="{'is-invalid': submitted() && isFieldInvalid('currentPassword', 'required')}"
            [type]="showCurrentPassword ? 'text' : 'password'"
            id="currentPassword"
            formControlName="currentPassword"
            placeholder="Introduce your current password"
          >
          <button 
          type="button" 
          class="btn btn-outline-secondary currentPassword-toggle-btn"
          (click)="toggleCurrentPasswordVisibility()"
          aria-label="Toggle current password visibility"
          >
              <i [class]="showCurrentPassword ? 'bi bi-eye-slash' : 'bi bi-eye'"></i>
          </button>
      </div>
      @if (submitted() && isFieldInvalid('currentPassword', 'required')) {
        <small class="text-danger">Current password is required</small>
      }
    </div>

    <!-- New Password Field and its Error Handling -->
    <div class="form-group">
      <label for="currentPassword">New Password</label>
      <div class="newPassword-input-container">
          <input 
            class="form-control"
            [ngClass]="{
              'is-invalid': submitted() && 
                (isFieldInvalid('password', 'required') || isFieldInvalid('password', 'minlength') 
                  || isFieldInvalid('password', 'maxlength') || isFieldInvalid('newPassword', 'passwordMismatch'))
            }"
            [type]="showNewPassword ? 'text' : 'password'"
            id="newPassword"
            formControlName="newPassword"
            placeholder="Introduce your new password"
          >
          <button 
            type="button" 
            class="btn btn-outline-secondary newPassword-toggle-btn"
            (click)="toggleNewPasswordVisibility()"
            aria-label="Toggle new password visibility"
          >
              <i [class]="showNewPassword ? 'bi bi-eye-slash' : 'bi bi-eye'"></i>
          </button>
      </div>
      @if (submitted() && isFieldInvalid('newPassword', 'required')) {
        <small class="text-danger">New password is required</small>
      }
      @if (submitted() && isFieldInvalid('newPassword', 'minlength')) {
        <small class="text-danger">New password must be at least 4 characters</small>
      }
      @if (submitted() && isFieldInvalid('newPassword', 'maxlength')) {
        <small class="text-danger">New password must be less than 255 characters</small>
      }
      @if (submitted() && isFieldInvalid('newPassword', 'passwordMismatch')) {
        <small class="text-danger">New password cannot be the same as the current password</small>
      }
    </div>

    <!-- Submit and general Error Handling -->
    <div class="form-actions">
      <button type="submit" class="btn btn-secondary btn-change" [disabled]="loading()">
        @if (loading()) {
          <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span> 
          Changing...
        } @else {
          Change Password
        }
      </button>
      @if (passwordError) {
        <small class="text-danger error-message">{{ passwordError }}</small>
      }
    </div>
    
  </form>
</section>