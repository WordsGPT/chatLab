<section class="profile-container">
  <!-- User Profile Header -->
  <h2>User Profile</h2>
  
  <!-- User Profile Form -->
  <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="profile-form">
    
    <!-- Email Field and its Error Handling -->
    <div class="form-group">
      <label for="email">Email</label>
      <input 
        class="form-control"
        [ngClass]="{
          'is-invalid': submitted() && 
            (isFieldInvalid('email', 'required') || isFieldInvalid('email', 'email') || isFieldInvalid('email', 'maxlength'))
        }"
        type="email"
        id="email"
        formControlName="email"
        autocomplete="email"
      >
      @if (submitted() && isFieldInvalid('email', 'required')) {
        <small class="text-danger error-message">Email is required</small>
      }
      @if (submitted() && isFieldInvalid('email', 'email')) {
        <small class="text-danger error-message">Please enter a valid email address.</small>
      }
      @if (submitted() && isFieldInvalid('email', 'maxlength')) {
        <small class="text-danger">Email must be less than 254 characters</small>
      }
    </div>

    <!-- Username Field and its Error Handling -->
    <div class="form-group">
      <label for="username">Username</label>
      <input 
        class="form-control"
        [ngClass]="{
          'is-invalid': submitted() &&
            (isFieldInvalid('username', 'required') || isFieldInvalid('username', 'minlength') || isFieldInvalid('username', 'maxlength'))
        }"
        type="text"
        id="username"
        formControlName="username"
        autocomplete="username"
      >
      @if (submitted() && isFieldInvalid('username', 'required')) {
        <small class="text-danger">Username is required</small>
      }
      @if (submitted() && isFieldInvalid('username', 'minlength')) {
        <small class="text-danger">Username must be at least 3 characters</small>
      }
      @if (submitted() && isFieldInvalid('username', 'maxlength')) {
        <small class="text-danger">Username must be less than 30 characters</small>
      }
    </div>

    <!-- Role Field and its Error Handling -->
    <div class="form-group" id="role-group">
      <label for="role">Role</label>
      <input 
        class="form-control"
        id="role" 
        type="text" 
        formControlName="role"
        readonly
      >
    </div>

    <!-- Submit and general Error Handling -->
    <div class="form-actions">
      <button type="submit" class="btn btn-secondary btn-profile" [disabled]="isUnchanged || loading()">
        @if (loading()) {
          <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span> 
          Saving...
        } @else {
          Save Changes
        }
      </button>

      @if (profileError) {
        <small class="text-danger error-message">{{ profileError }}</small>
      }
    </div>

  </form>
</section>