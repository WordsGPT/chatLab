<section class="create-experiment">

  <!-- Experiment Form -->
  <form [formGroup]="experimentForm">

    <!-- Name Field and its Error Handling -->
    <div class="form-group">
      <label for="name">Name</label>
      <input
        class="form-control"
        [ngClass]="{
          'is-invalid': submitted() && 
            (isFieldInvalid('name', 'required') || isFieldInvalid('name', 'minlength') || isFieldInvalid('name', 'maxlength'))
        }"
        type="text"
        id="name"
        formControlName="name"
        placeholder="Introduce experiment name"
        autocomplete="name"
      >
      @if (submitted() && isFieldInvalid('name', 'required')) {
        <small class="text-danger error-message">Name is required</small>
      }
      @if (submitted() && isFieldInvalid('name', 'minlength')) {
        <small class="text-danger error-message">Name must be at least 1 character long</small>
      }
      @if (submitted() && isFieldInvalid('name', 'maxlength')) {
        <small class="text-danger">Name must be less than 100 characters</small>
      }
    </div>

    <!-- Description Field -->
    <div class="form-group">
      <label for="description">Description</label>
      <textarea
        class="form-control"
        id="description"
        formControlName="description"
        placeholder="Introduce experiment description"
      ></textarea>
    </div>

    <!-- LLM Provider and Model Selection Fields -->
    <experiment-llm-selector 
      [parentForm]="experimentForm" 
      [selectedProviders]="selectedProviders()"
      [submitted]="submitted()"
    />

    <!-- Prompts Field -->
    <experiment-prompts
      [parentForm]="experimentForm"
      [submitted]="submitted()"
    />

    <!-- Variables Fields -->
    <experiment-variables
      [parentForm]="experimentForm"
      [submitted]="submitted()"
    />

    <!-- LLM Configuration Fields -->
    <experiment-llm-configuration
      [parentForm]="experimentForm"
      [submitted]="submitted()"
    />

    <div class="submission-buttons">
      <button class="submit" (click)="onSubmit()">Create Experiment</button>
      <button class="submit" (click)="onSubmitAndGo()">Create and Go</button>
    </div>

    @if(submitted() && experimentError) {
      <small class="text-danger">{{ experimentError }}</small>
    }
  </form>
</section>
