<div [formGroup]="parentForm()">

  <!-- Prompts Configuration-->
  <fieldset formArrayName="prompts">
    <legend>Prompts</legend>

    <div class="prompts">
      <!-- Prompt Groups -->
      @for(prompt of prompts.controls; let i = $index; track i) {
        <div class="prompt-group">

          <!-- Remove Prompt Button -->
          @if((i === prompts.length - 1) && (prompts.length > 1)) {
            <button type="button" (click)="removePrompt(i)">
              - - Delete - -
            </button> 
          }

          <!-- Prompt Input Field -->
          <div [formGroupName]="i" class="prompt">
            <label for="prompt-{{i}}">Prompt {{i + 1}}</label>
            <input
              class="form-control"
              [ngClass]="{
                'is-invalid': submitted() && (isFieldInvalid('prompts.' + i + '.prompt', 'required'))
              }"
              type="text"
              id="prompt-{{i}}"
              formControlName="prompt"
              [ngbTypeahead]="searchPrompts"
              [resultFormatter]="formatter"
              [inputFormatter]="formatter"
              placeholder="Introduce a prompt"
            >
          </div>

          @if (submitted() && isFieldInvalid('prompts.' + i + '.prompt', 'required')) {
            <small class="text-danger error-message">Prompt is required</small>
          }

          <!-- Add Prompt Button -->
          @if(i === prompts.length - 1) {
            <button type="button" (click)="addPrompt()">
              - - Add prompt - -
            </button>
          }
        </div>
      }
    </div>
  </fieldset>
</div>